


--login nick role password

create table public.users (
	id serial4 not null,
	login varchar(255),
	username varchar(255),
	password varchar(255),
	is_banned varchar(1) default 'N',
	constraint users_pk primary key (id)
)


create table public.roles (
	id serial4 not null,
	roles_name varchar(255) ,
	constraint roles_pk primary key (id)
)

create table public.user_to_roles (
	user_id integer,
	role_id integer,
	primary key(user_id,role_id),
	constraint user_id_fk foreign key (user_id) references public.users(id),
	constraint role_id_fk foreign key (role_id) references public.roles(id)
)


drop table public.users
drop table public.roles
drop table public.user_to_roles


insert into public.users ( login, username, password) values ('first', 'Sasha', 123);
insert into public.users ( login, username, password) values ('second', 'Masha', 123);
insert into public.users ( login, username, password) values ('third', 'Pasha', 123);
insert into public.users ( login, username, password) values ('forth', 'Misha', 123);

select * from users

select id from public.users where username = 'Masha'

delete from users where id = 15

insert into public.roles ( roles_name) values ('ADMIN');
insert into public.roles ( roles_name) values ('USER');

select * from roles r

insert into public.user_to_roles (user_id, role_id) values (1,1);
insert into public.user_to_roles (user_id, role_id) values (2,2);
insert into public.user_to_roles (user_id, role_id) values (3,2);
insert into public.user_to_roles (user_id, role_id) values (4,2);

select * from user_to_roles ur

delete from user_to_roles where user_id = 15

select u.username, r.roles_name from users u, roles r, user_to_roles ur where ur.user_id = u.id and ur.role_id = r.id and r.roles_name = 'ADMIN'

select u.id as id, u.login as login, u.username as username, r.roles_name, u.password  from users u, roles r, user_to_roles ur where ur.user_id = u.id and ur.role_id = r.id

update public.users  set username = 'Pasha' where id = 3

update public.users  set is_banned = 'N' where id = 3
